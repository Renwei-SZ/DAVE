#!/bin/sh

homepath=$(cd `dirname $0`; pwd)

VERSION=5.2.1

if [ ! -f jemalloc-${VERSION}.tar.bz2 ]; then
  wget https://github.com/jemalloc/jemalloc/releases/download/${VERSION}/jemalloc-${VERSION}.tar.bz2
fi
if [ ! -d ./jemalloc-${VERSION} ]; then
  tar -jxvf jemalloc-${VERSION}.tar.bz2
fi

cd jemalloc-${VERSION}

./autogen.sh --prefix=/dave/tools/jemalloc CFLAGS="-fPIC" CXXFLAGS="-fPIC"

make && make install

cd $homepath

rm -rf setup
mkdir setup
cp -r /dave/tools/jemalloc/* ./setup

rm -rf jemalloc-${VERSION}